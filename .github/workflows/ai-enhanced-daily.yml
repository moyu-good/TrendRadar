name: ðŸ¤– AIå¢žå¼ºè¶‹åŠ¿æŠ¥å‘Šå®šæ—¶å‘é€

on:
  schedule:
    # æ¯å¤© UTC 00:00 è¿è¡Œ (æ—¥æœ¬æ—¶é—´ 9:00 AM)
    - cron: '0 0 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  send-ai-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®PythonçŽ¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
        
    - name: å®‰è£…UVåŒ…ç®¡ç†å™¨
      run: |
        curl -LsSf https://astral.sh/uv/install.sh | sh
        echo "$HOME/.cargo/bin" >> $GITHUB_PATH
        
    - name: å®‰è£…ä¾èµ–
      run: |
        uv pip install --system -r requirements.txt
        
    - name: æ›´æ–°é‚®ä»¶é…ç½®
      run: |
        # åˆ›å»ºä¸´æ—¶é…ç½®æ–‡ä»¶ç”¨äºŽGitHub Actions
        mkdir -p config
        cat > config/github_actions_config.yaml << EOF
        email:
          smtp_server: "${{ secrets.SMTP_SERVER || 'smtp.qq.com' }}"
          smtp_port: ${{ secrets.SMTP_PORT || 587 }}
          sender_email: "${{ secrets.SENDER_EMAIL }}"
          sender_password: "${{ secrets.SENDER_PASSWORD }}"
          recipient_email: "${{ secrets.RECIPIENT_EMAIL }}"
          
        ai_analysis:
          enabled: true
          summary_length: 800
          include_trends: true
          include_insights: true
          include_predictions: true
          
        logging:
          level: "INFO"
          file: "trendradar.log"
        EOF
        
    - name: è¿è¡ŒAIå¢žå¼ºæŠ¥å‘Š
      run: |
        python send_ai_report_email.py config/github_actions_config.yaml
        
    - name: ä¸Šä¼ æ—¥å¿—æ–‡ä»¶
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: trendradar-logs-${{ github.run_number }}
        path: trendradar.log
        retention-days: 7
        
    - name: ä¸Šä¼ AIæŠ¥å‘Š
      if: success()
      uses: actions/upload-artifact@v3
      with:
        name: ai-report-${{ github.run_number }}
        path: output/ai_emails/*.html
        retention-days: 7